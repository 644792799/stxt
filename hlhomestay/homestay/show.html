$def with (homestay)
$code:
    h = homestay
    c = Calendar()
    m = c.monthdatescalendar(today().year, today().month)
    rooms = homestay.room_set

$def date_class(d):
    $if d == today():
        today
    $elif d < today():
        passed
    $elif d > today():
        future

$def date_reservation(d):
    $if d == today():
        <td class="today">
    $if d < today():
        <td class="passed">
    $if d > today():
        <td class="future">
    <div class="date_label">$d.day</div>
    <div class="room_list">
    $for r in rooms:
        <a class="room_reservation" \
           href="rooms/$:r.key()/reservations/new">$:r.name</a><br/>
    </div>

<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01//EN' 'http://www.w3.org/tr/html4/strict.dtd'> 
<html lang="zh-tw"> 
<head><title>民宿基本資料</title>
<link rel="stylesheet" href="/css/homestay.css"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
</head>
<body>
<h1>民宿基本資料</h1>
<table>
<tr><td>名稱</td><td>$:h.name</td></tr>
<tr><td>地址</td><td>$:h.address</td></tr>
<tr><td>主人</td><td>$:h.owner</td></tr>
<tr><td>電子郵件</td><td>$:h.email</td></tr>
<tr><td>部落格</td><td>$:h.blog</td></tr>
<tr>
<td><a href="/homestays">回</a>
改
刪
</tr>
</table>
<h1>客房清單</h1>
<table>
<tr>
  <td>名稱</td>
  <td>平日</td>
  <td>假日</td>
  <td><a href="/homestays/$:h.key()/rooms/new">新</a></td>
  <td><a href="javascript:history.go(-1)">回</a></td>
  </tr>
$for r in h.room_set:
    <tr>
        <td>$r.name</td>
        <td>$r.price</td>
        <td>$r.holiday_price</td>
        <td><a href="/rooms/$:r.key()/edit">改</a></td>
        <td><a href="/rooms/$:r.key()/delete">刪</a></td>
    </tr>
</table>
<div id = "canlendar">
  <div id = "operations">
  </div>
  <table id="canlendar">
  <tr id="week_label">
  <td>一</td><td>二</td><td>三</td><td>四</td>
  <td>五</td><td>六</td><td>日</td>
  </tr>
  $for w in m:
      <tr class="week">
      $for d in w:
          $:date_reservation(d)
      </tr>
  </table>
</div>
</body>
</html>
