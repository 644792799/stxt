{% extends "base.html" %}
{% block content %}
<div id="form_content">
<script src="/js/jquery-1.4.2.js" type="text/javascript"></script>
<script src="/js/validate_input.js"></script>
<script src="/js/date.format.js"></script>
<script>
function check_form(f){
    with(f) {
        if(check_date(checkin, 
            "入住日期格式錯誤，格式如20100912")==false){
           return false 
        } 

        if(check_date(checkout, 
            "退房日期格式錯誤，格式如20100912")==false){
           return false 
        } 

        if(check_phone(phone, 
            "聯絡電話格式錯誤，格式如0911831831或07-3351444")==false){
           return false 
        } 

        if(check_email(email, 
            "電子郵件格式錯誤，格式如abcd@example.com")==false){
           return false 
        } 
            
        $.getJSON('/period_books.json', 
                  {room: room.value, 
                   checkin: checkin.value, 
                   checkout: checkout.value},
                   function(books) { 
                       if (books.length == 0)
                            f.submit()

                       $('#notice').empty()
                       $('#notice').append("此房間於以下期間有訂房:"
                                    ).append("<br/>")

                       for (b in books) {
                            b = books[b]
                            $('#notice').append(
                                b.checkin.format('yyyymmdd') + 
                                ' ~ ' + 
                                b.checkout.format('yyyymmdd')
                                ).append("<br/>")
                       }
                       
                       $('#notice').show()

                       return false
                    }

        );

    }
    return false
}
  </script>
  <form method="post" 
        onsubmit="return check_form(this)"
        action='/{{r.room.key}}/{{r.checkin|date:"Ymd"}}'>
  <table class="form">
    <tr><th colspan="2">訂房作業</th></tr>

    <tr><td id="notice" colspan="2" style="display:none"></td></tr>

    <tr><td>房間</td>
        <td>{{r.room.name}}
            <input name="room" type="hidden" value="{{r.room.key}}"/>
    </td></tr>

    <tr><td>入住日期</td>
      <td><input name="checkin" type="text"
                 value='{{r.checkin|date:"Ymd"}}'/>
    </td></tr>

    <tr><td>退房日期</td>
        <td><input name="checkout" type="text"
                   value='{{r.checkout|date:"Ymd"}}'/>
    </td></tr>

    <tr><td>姓名</td>
        <td><input name="name" type="text" 
                   value="{{r.name}}"/>
    </td></tr>

    <tr><td>聯絡電話</td>
        <td><input name="phone" type="text"
                   value="{{r.phone}}"/>
    </td></tr>

    <tr><td>電子郵件</td>
        <td><input name="email" type="text"
                   value="{{r.email}}"/>
    </td></tr>

    <tr><td>訂單日期</td>
        <td>{{r.create_date|date:"Ymd"}}
            <input name="create_date" type="hidden" 
                   value='{{r.create_date|date:"Ymd"}}'/>
    </td></tr>

    <tr><td colspan="2">備註</td></tr>
    <tr><td colspan="2">
        <textarea name="comment">{{r.comment}}</textarea>
    </td></tr>

    <tr><td><input type="submit" value="建立"/></td>
        <td>
            <a href="{{r.client_calendar_path}}">月曆</a>
        </td></tr>
  </table>
</form>
</div>

{% endblock %} 
