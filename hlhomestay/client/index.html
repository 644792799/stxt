$def with (homestay)
$code:
    h = homestay
    c = Calendar()
    m = c.monthdatescalendar(today().year, today().month)
    rooms = homestay.room_set
    
$def available_rooms(d):
    $if d == today():
        <td class="today">
    $elif d < today():
        <td class="passed">
    $elif d > today():
        <td class="future">
    <div class="date_label">$d.day</div>
    <div class="room_list">
    $for r in h.available_rooms(d):
        <a class="available_room"
           href="/$:r.key()/$:{strftime(d, '%Y%m%d')}">$:r.name</a><br/>
    </div>

<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01//EN' 'http://www.w3.org/tr/html4/strict.dtd'> 
<html lang="zh-tw"> 
<head><title>$:{h.name}訂房系統</title>
<link rel="stylesheet" href="/css/homestay.css"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
</head>
<body>
<div id="topbar">
    <div id="homestay_name">$:{h.name}訂房系統</div>
</div>
<div id="left_pane">
<table class="form">
<tr><td class="label">民宿主人：</td><td colspan="2">$:h.owner</td></tr>
<tr><td class="label">地址：</td><td colspan="2">$:h.address</td></tr>
<tr><td class="label">電子郵件：</td><td colspan="2">$:h.email</td></tr>
<tr><td class="label">部落格：</td><td colspan="2">$:h.blog</td></tr>
$for r in h.room_set:
    <tr>
        <td class="label">$:{r.name}：</td>
        <td>$r.price</td>
        <td>假日：$r.holiday_price</td>
    </tr>
</table>
</div>
<div id="calendar">
  <table id="calendar">
  <tr id="week_label">
  <td>一</td><td>二</td><td>三</td><td>四</td>
  <td>五</td><td class="saturday">六</td><td class="sunday">日</td>
  </tr>
  $for w in m:
      <tr class="week">
      $for d in w:
          $:available_rooms(d)
      </tr>
  </table>
</div>
</body>
</html>
