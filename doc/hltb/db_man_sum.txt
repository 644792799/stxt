資料庫管理
----------

1.訂有「地方稅資訊平台稅務主機及資料庫管理作業辦法」。

1.2.

系統人員欲申請或註銷存取資料庫帳號時需填具
「資料庫帳號(權限)異動申請表」陳核，並交由資料庫管理員配賦。

1.3.

財稅資料中心系統負責人或維護廠商，因處理異常而需存取本局資料庫時，
由本局系統人員代為填寫
「地方稅平台(防火牆、稅務系統、應用伺服器、資料庫伺服器) 使用申請單」，
經陳核後，交由資料庫管理員配賦帳號密碼，配賦權限以 select 為原則，使用完畢立即停用或註銷其帳號。

1.4

系統人員執行結構化查詢語言(SQL)之異動指令需填具
「稅務資料庫使用異動指令申請表」，
並載明欲執行之日期、時間、異動之系統、表格、原因及異動指令，
會資料庫管理員審核無誤後，並經資訊科主管核准，
於具有連線、螢幕側錄監控之臨場作業管制區機台執行，異動權限當日移除。

1.5.

系統人員因公務需求需將資料庫相關資料匯出或匯入，
應先填寫「資料庫資料表匯出/匯入申請表」陳核後，
由資料庫管理員執行資料匯出匯入作業。

1.6.資料庫使用及授權情形稽核機制：

1.6.1.

自行開發「資料庫自動監控系統」每日執行監控資料庫使用及授權情形，
並將檢查結果註記於自動產出之「資料庫每日檢查表」陳核。

1.6.2.

透過自行開發之「資料庫自動監控系統」
每日17:30時自動移除使用者資料庫帳號修改權限，
避免修改權限漏未移除情形，以降低資料庫風險。

1.6.3.

資料庫管理員使用自行開發之「資料庫每日檢核」功能，
並於每日執行檢查作業，
自動檢查各帳號是否有逾3個月未更新密碼及其他異常情形，
透過本系統能快速精確達到檢查效能，
故本作業由週檢查改成日檢查，
並於每月列印「使用者帳號及使用情形」報表陳核。

1.6.4.

資料庫管理人員每季產出「資料庫帳號權限(select)配赋清單」，
會系統人員檢視所屬權限，是否符合業務職掌，據以清理權限，
以落實使用者帳戶及權限管理。

1.6.5.

自行開發「資料庫使用者稽核系統」
當使用者執行異動Table時（INSERT、UPDATE、SELETE、CREATE、DROPtable）
會啟動Audit稽核機制，監測資料庫運作狀況，
資料庫管理員透過自行開發親和且易於操作之 WEB 介面，
產出內含指定使用者及指定期間所執行之程式碼及執行的機台 IP 
等資訊之「稅務資料庫使用異動指令稽核報表」，
與使用者填具之「稅務資料庫使用異動指令申請表」
稽核是否有逾越權限異動情形並陳核。

1.6.6.

自行開發資料庫管理員操作系統，透過可稽核管理介面，
於DBA操作資料庫時，可稽核管理介面會建立相關操作紀錄，
並複製至股長、科長的電腦，隨時監控並利事後稽核管理員行為。

2.資料庫異常監控及處理相關作業

2.1.

自行開發「資料庫自動監控系統」每日執行資料庫異常監控作業，
並將檢查結果註記於自動產出之「資料庫每日檢查表」陳核。

2.1.1.檢查alert.log是否異常

2.1.2.檢查 DB 主機磁碟機空間是否異常

2.1.3.檢查Table, Index 的有效情況是否異常

2.1.4.檢查SGA 使用情形是否異常

2.1.5.檢查資料庫的備份模式是否異常:

2.1.6.自動檢查檢查資料庫中各 Table 及 Index 是否置放於正確的 TableSpace。

2.1.7.檢查3 個月前的 batchlog 是否備出及是否異常

2.2.建置「資料庫專業監控系統」即時監控資料庫服務狀態

2.2.1.

當資料庫無法連線時委由廠商開發之「資料庫專業監控系統」 
會自動記錄並透過電子郵件通報機制，將錯誤訊息傳送給設定之資料庫管理員，
當資料庫恢復連線時，
系統會自動記錄並透過電子郵件通報機制將恢復連線訊息傳送給資料庫管理員，
記錄資料庫離線，記錄可以時間查詢累計離線時間及恢復連線時間。

2.2.2.

針對資料庫是否有鎖定狀況提供即時監控，
當資料庫有鎖定狀況超過管理者設定之鎖定時間上限時，自動記錄發生時狀況，
資訊包含造成鎖定的使用者、被鎖定的使用者、鎖定事件型態，
並將執行中的SQL語法，透過電子郵件通報機制，提供後續追蹤問題。

2.2.3.

將執行中SQL設定”可等待的時間”當發生等待事件且超過所設定的秒數時，
自動記錄使用者所發生等待之事件類型(索引檔讀取、表格掃描、
記憶體等待、系統資源等待)，
並提供進一步訊息提供使用者分析(包含執行中的 sql語法、程式參數值)，
於監控畫面即時顯示有狀況之用戶端程式及事件類別以電子郵件通報機制。

2.2.4.

利用 「資料庫專業監控系統」 當資料庫背景程式沒有啟動時，
系統會自動記錄在系統主畫面顯示並透過電子郵件通報機制傳送給資料庫管理員，
監控系統也提供設定，可自動啟動資料庫。

2.2.5.

當資料庫發生異常時，資料庫管理員需填具「資料庫異常處理申請表」，
陳核後資料庫管理員查明原因，並進行後續處理，
並將處理結果填具「資料庫異常處理報告書」陳核。

3.資料庫表格空間檢核管理及效能調校作業

3.1.

本局稅務資料庫表格空間為 
local management (表格空間資訊利用 bitmap 方式記載在 datafile 中)，
extent 大小統一為4MB。
為配合 db block 8K 格式，表格空間採用JFS2 格式。
(OS block 改 4k 適合線上作業)，資料庫區塊(block)存取效能可增加一倍以上。
表格空間不採用自動增長方式，datafile 大小以不超過 5GB為原則

3.2.

自行開發「資料庫自動監控系統」，資料庫管理員透過本系統每日執行資料庫
表格空間檢查作業，以PYTHON 程式自動檢核資料庫表格空間使用率是否超過90%
，並將檢查結果註記於系統自動產出之「資料庫每日檢查表」陳核，以自動檢核
取代人工逐一檢視，避免誤漏。

3.3.

建置「資料庫專業監控系統」即時監控表格空間使用狀況，
若資料庫表格空間可用百分比低於設定之上限(10%)時，
系統會自動將空間不足之表格記錄，
於系統主畫面顯示並透過電子郵件通報管理者即時處理。

3.4.

當資料庫表格空間不足時，
資料庫管理員需填具「資料庫異常處理申請表」核准後，
由管理員手動加大表格空間，
並將處理結果填具「資料庫異常處理報告書」陳核。
【99年未發生資料庫表格空間不足情形】

3.4.表格空間設定調校

3.4.1.每月產製「資料庫表格空間使用情形報表」：

透過自行開發之「資料庫自動監控系統」
每月產製「資料庫表格空間使用率報表」陳核，確實掌握表格空間資訊，
自動透過 e-mail 通報相關人員，供每季資料庫效能調校參考。

3.4.2.每月產製「資料庫成長分析報表」：

利用自行開發之「資料庫自動監控系統」
每季產製「資料庫成長分析報表」，
可清楚了解資料庫空間成長(變化狀況)，供每季資料庫調校時調整參考。

3.5.暫存空間管理

3.5.
利用本局自行開發之「資料庫自動監控系統」，
每月產製「暫存空間使用狀況報表」，供每季資料庫調校時調整參考

3.6.

為維持資料庫高效能服務，
委由資料庫專業維護廠商每季辦理效能調教作業，
分析本局資料庫使用狀況並調整效能，調校報告經陳核後，
作為資料庫效能管理參考。

4.資料庫備份策略與監控及回復相關作業紀錄

4.1.

訂有「檔案備援暨媒體管理要點」。

4.2

稅務及OA資料庫透過「VERITAS NetBackup」備份系統，
設定排程每日執行全備份，週一至週五自動備份於磁帶櫃，
週日備援二份異地存放於第一媒體室及第二媒體室，
另於每月28日備援一份異地存放玉里分局。

4.3.

為避免稅務資料庫個別資料表因程式執行或操作錯誤，
於每日零時設定排程自動執行將資料表全部匯出成檔儲存於DB主機，
於線上保留3日，做為線上資料表異常快速回復之用。


4.4.

本局資料庫之tablespace 啟用Recyclebin功能，
若資料庫管理人員誤刪資料表格，可以透過此機制立即回復誤刪表格。

4.5

本局資料庫undo_retention 時間設定為 6 小時，
若系統人員輸入錯誤資料皆可透過此機制立即復原6小時以內之異動資料。

4.6.

藉由 logminer 機制，可將分析之交易紀錄，在不停機、
不關機之作業環境下，使用逆向工程技術，
將誤改、誤刪之資料找回相對之 SQL code，經判斷後再將資料進行回復。

4.7.

本局於99年10月20日資料庫災變回復演練第三項
「演練項目三.模擬人員誤刪表格數筆資料，利用 Logminer 機制即時回復」，
實際操作log miner 之回復情形，確保此機制之可用性。

4.8.備份監控作業

每日由主機操作員依「地方稅主機每日檢查表」
第 32 至 35 檢查項檢視備援情況及紀錄，
並列印「備援情形報告表」陳核，若發現備援失敗，
立即查明異常原因，排除異常後，以手動重新啟動備援，
以確保備援資料之完整性與正確性

4.9.

每月辦理備份媒體檔案試讀，並由媒體管理人員將試讀情形登錄於媒體管理系統，按月列印媒體試讀結果清單陳核。

4.10.

訂定本局「99年度網路申報資料庫災變回復演練計畫」，於99年5月25日辦理網路申報資料庫主機異常無法提供服務，重建另一網路申報DB主機，並利用Acronis備份系統辦理備援檔案回復作業，驗證災變後備援媒體之可回復性，並撰寫「災變回復演練報告」陳核。

4.11.

訂定「99年度資料庫災變回復演練計畫」，於99年10月20辦理資料庫主機異常，於測試機上建立正式機資料庫相當目錄，以備份磁帶，進行資料庫回復作業之災變回復演練，驗證災變後備援媒體之可回復性，並撰寫「資料庫災變回復演練報告」陳核。

5.資料庫連線安全管理機制及相關作業紀錄

5.1.Listener.log查核

自行開發「資料庫自動監控系統」
每日檢查Listener.log是否有異常IP或異常程式連線，
並將檢查結果註記於自動產出之「資料庫每日檢查表」陳核。

5.2.設臨場作業管制區

臨場作業管制區電腦設有螢幕側錄監控系統，
且無裝置USB儲存設備、無裝置印表機、燒錄機、列印設備、
網路芳鄰及電子郵件系統，資料庫之查詢、異動作業均需於此區電腦執行。

5.3.

建置SGS5420 多功能防火牆，利用安全政策控管內外連線，
利用防火牆設定區隔 DB 主機及 AP 之網路區段，加強 DB 主機安全管控。

5.4.

稅務內網採用二段式資料庫架構CLIENT <=> AP SERVER <=> DATABASE，
亦即使用者無法直接存取資料庫，需透過應用伺服器連線，
有效降低資料庫直接遭受攻擊之機率。

5.5.自行開發「電腦螢幕側錄系統」加強對資料庫存取之監控作業：

5.6.資料庫管理員（DBA）操作之監控：

自行開發資料庫管理員操作系統，透過可稽核管理介面，
於DBA操作資料庫時，可稽核管理介面會建立相關操作紀錄，
並複製至股長、科長的電腦，隨時監控並利事後稽核管理員行為。
